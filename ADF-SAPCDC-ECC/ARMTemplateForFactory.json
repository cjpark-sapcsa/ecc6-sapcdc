{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "ADF-SAPCDC-ECC"
		},
		"SAPCDC2ECC6_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'SAPCDC2ECC6'"
		},
		"SAPCDCS4H_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'SAPCDCS4H'"
		},
		"adls4sapecc_accountKey": {
			"type": "secureString",
			"metadata": "Secure string for 'accountKey' of 'adls4sapecc'"
		},
		"SAPCDC2ECC6_properties_typeProperties_clientId": {
			"type": "string",
			"defaultValue": "100"
		},
		"SAPCDC2ECC6_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "10steps2s4"
		},
		"SAPCDC2ECC6_properties_typeProperties_server": {
			"type": "string",
			"defaultValue": "20.160.178.48"
		},
		"SAPCDC2ECC6_properties_typeProperties_systemNumber": {
			"type": "string",
			"defaultValue": "00"
		},
		"SAPCDCS4H_properties_typeProperties_clientId": {
			"type": "string",
			"defaultValue": "100"
		},
		"SAPCDCS4H_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "s4h_ext"
		},
		"SAPCDCS4H_properties_typeProperties_server": {
			"type": "string",
			"defaultValue": "4.227.248.152"
		},
		"SAPCDCS4H_properties_typeProperties_systemNumber": {
			"type": "string",
			"defaultValue": "00"
		},
		"adls4sapecc_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://sapeccqas2adf.dfs.core.windows.net/"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/EPMPOFullDelta')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "EPMPOFullDelta",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EPMPODelta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"S4HEPMPO": {},
									"ADLS": {}
								}
							},
							"staging": {
								"linkedService": {
									"referenceName": "adls4sapecc",
									"type": "LinkedServiceReference"
								},
								"folderPath": "demo/staging"
							},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine",
							"continuationSettings": {
								"customizedCheckpointKey": "78963da4-2e7e-4085-963d-4df3c85e5e98"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/dataflows/EPMPODelta')]",
				"[concat(variables('factoryId'), '/linkedServices/adls4sapecc')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/pipeline1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "copyFIAR2ADLS",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "dataflowFIAR",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {
								"linkedService": {
									"referenceName": "adls4sapecc",
									"type": "LinkedServiceReference"
								},
								"folderPath": "demo"
							},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine",
							"continuationSettings": {
								"customizedCheckpointKey": "5d5e03cf-3357-4de1-8c6a-44a76b971406"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/dataflows/dataflowFIAR')]",
				"[concat(variables('factoryId'), '/linkedServices/adls4sapecc')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/salesordernumber')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "salesordernumbers",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "s4hordernos",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"salesordernumber": {},
									"salesordernosADSL": {}
								}
							},
							"staging": {
								"linkedService": {
									"referenceName": "adls4sapecc",
									"type": "LinkedServiceReference"
								},
								"folderPath": "demo/staging"
							},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine",
							"continuationSettings": {
								"customizedCheckpointKey": "b73126db-00e7-45b3-ad52-da7344b9dc50"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/dataflows/s4hordernos')]",
				"[concat(variables('factoryId'), '/linkedServices/adls4sapecc')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/vendersalesfigures')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Vendersalesfigures",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "VenderSalesFigures",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"VenderSalesFigures": {},
									"ADLSvendersales": {}
								}
							},
							"staging": {
								"linkedService": {
									"referenceName": "adls4sapecc",
									"type": "LinkedServiceReference"
								},
								"folderPath": "demo/staging"
							},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine",
							"continuationSettings": {
								"customizedCheckpointKey": "d3c6fdb8-430c-4d17-a472-b7d93ee28226"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/dataflows/VenderSalesFigures')]",
				"[concat(variables('factoryId'), '/linkedServices/adls4sapecc')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/S4HEPMPO')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "SAPCDCS4H",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SapOdpResource",
				"schema": [],
				"typeProperties": {
					"context": "ABAP_CDS",
					"objectName": "SEPM_IPO$P"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SAPCDCS4H')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/S4HSalesOrderNo')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "SAPCDCS4H",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SapOdpResource",
				"schema": [],
				"typeProperties": {
					"context": "SAPI",
					"objectName": "0COORDER_TEXT"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SAPCDCS4H')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SAPECC_FI_AR')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "SAPCDC2ECC6",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SapOdpResource",
				"schema": [],
				"typeProperties": {
					"context": "SAPI",
					"objectName": "0FI_AR_4"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SAPCDC2ECC6')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/VenderSalesFigures')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "SAPCDC2ECC6",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SapOdpResource",
				"schema": [],
				"typeProperties": {
					"context": "SAPI",
					"objectName": "0FI_AP_6"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SAPCDC2ECC6')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SAPCDC2ECC6')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "ECC6 - SLT - CDC",
				"annotations": [],
				"type": "SapOdp",
				"typeProperties": {
					"clientId": "[parameters('SAPCDC2ECC6_properties_typeProperties_clientId')]",
					"language": "EN",
					"sncMode": false,
					"userName": "[parameters('SAPCDC2ECC6_properties_typeProperties_userName')]",
					"subscriberName": "ECC2ADFviaCDC",
					"password": {
						"type": "SecureString",
						"value": "[parameters('SAPCDC2ECC6_password')]"
					},
					"server": "[parameters('SAPCDC2ECC6_properties_typeProperties_server')]",
					"systemNumber": "[parameters('SAPCDC2ECC6_properties_typeProperties_systemNumber')]"
				},
				"connectVia": {
					"referenceName": "ecc6ehp6-Win2-IP",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/integrationRuntimes/ecc6ehp6-Win2-IP')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SAPCDCS4H')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "SAPCDCS4H 2021FPs1",
				"annotations": [],
				"type": "SapOdp",
				"typeProperties": {
					"clientId": "[parameters('SAPCDCS4H_properties_typeProperties_clientId')]",
					"sncMode": false,
					"userName": "[parameters('SAPCDCS4H_properties_typeProperties_userName')]",
					"subscriberName": "s4hadfcdc",
					"password": {
						"type": "SecureString",
						"value": "[parameters('SAPCDCS4H_password')]"
					},
					"server": "[parameters('SAPCDCS4H_properties_typeProperties_server')]",
					"systemNumber": "[parameters('SAPCDCS4H_properties_typeProperties_systemNumber')]"
				},
				"connectVia": {
					"referenceName": "s4hsapcdc",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/integrationRuntimes/s4hsapcdc')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/adls4sapecc')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "adls4sapecc datalake",
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('adls4sapecc_properties_typeProperties_url')]",
					"accountKey": {
						"type": "SecureString",
						"value": "[parameters('adls4sapecc_accountKey')]"
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ecc6ehp6-Win2-IP')]",
			"type": "Microsoft.DataFactory/factories/integrationRuntimes",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "SelfHosted",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/s4hsapcdc')]",
			"type": "Microsoft.DataFactory/factories/integrationRuntimes",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "SelfHosted",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/EPMPODelta')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "S4HEPMPO",
								"type": "DatasetReference"
							},
							"name": "S4HEPMPO"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "adls4sapecc",
								"type": "LinkedServiceReference"
							},
							"name": "ADLS",
							"rejectedDataLinkedService": {
								"referenceName": "adls4sapecc",
								"type": "LinkedServiceReference"
							}
						}
					],
					"transformations": [],
					"scriptLines": [
						"source(output(",
						"          PURCHASEORDERUUID as binary,",
						"          PURCHASEORDER as string,",
						"          SHORTTEXTGROUPUUID as binary,",
						"          SUPPLIERUUID as binary,",
						"          TRANSACTIONCURRENCY as string,",
						"          GROSSAMOUNTINTRANSACCURRENCY as decimal(19,2),",
						"          NETAMOUNTINTRANSACTIONCURRENCY as decimal(19,2),",
						"          TAXAMOUNTINTRANSACTIONCURRENCY as decimal(19,2),",
						"          PURCHASEORDERLIFECYCLESTATUS as string,",
						"          PURCHASEORDERAPPROVALSTATUS as string,",
						"          PURCHASEORDERCONFSTATUS as string,",
						"          PURCHASEORDERORDERINGSTATUS as string,",
						"          PURCHASEORDERINVOICINGSTATUS as string,",
						"          PURCHASEORDEROVERALLSTATUS as string,",
						"          CREATEDBYUSER as binary,",
						"          CREATIONDATETIME as decimal(28,7),",
						"          LASTCHANGEDBYUSER as binary,",
						"          LASTCHANGEDDATETIME as decimal(28,7)",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     staged: true,",
						"     enableCdc: true,",
						"     readMode: 'fullAndIncrementalLoad',",
						"     keys:['PURCHASEORDERUUID'],",
						"     format: 'sapObject',",
						"     partitionBy('roundRobin', 2)) ~> S4HEPMPO",
						"S4HEPMPO sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'demo',",
						"     folderPath: 'staging',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable:true,",
						"     insertable:true,",
						"     updateable:true,",
						"     upsertable:true,",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> ADLS"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/S4HEPMPO')]",
				"[concat(variables('factoryId'), '/linkedServices/adls4sapecc')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/VenderSalesFigures')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "VenderSalesFigures",
								"type": "DatasetReference"
							},
							"name": "VenderSalesFigures",
							"description": "VenderSalesFigures"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "adls4sapecc",
								"type": "LinkedServiceReference"
							},
							"name": "ADLSvendersales",
							"rejectedDataLinkedService": {
								"referenceName": "adls4sapecc",
								"type": "LinkedServiceReference"
							}
						}
					],
					"transformations": [],
					"scriptLines": [
						"source(output(",
						"          LIFNR as string,",
						"          BUKRS as string,",
						"          FISCPER as string,",
						"          FISCVAR as string,",
						"          CURTYPE as string,",
						"          CURRENCY as string,",
						"          UM01S as decimal(19,2),",
						"          UM01H as decimal(19,2),",
						"          UM01K as decimal(19,2),",
						"          UM01U as decimal(19,2),",
						"          UPDMOD as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     staged: true,",
						"     enableCdc: true,",
						"     readMode: 'fullAndIncrementalLoad',",
						"     keys:['LIFNR'],",
						"     format: 'sapObject',",
						"     partitionBy('roundRobin', 2)) ~> VenderSalesFigures",
						"VenderSalesFigures sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'demo',",
						"     folderPath: 'staging',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable:true,",
						"     insertable:false,",
						"     updateable:true,",
						"     upsertable:true,",
						"     keys:['LIFNR'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> ADLSvendersales"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/VenderSalesFigures')]",
				"[concat(variables('factoryId'), '/linkedServices/adls4sapecc')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/dataflowFIAR')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "SAPECC_FI_AR",
								"type": "DatasetReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "adls4sapecc",
								"type": "LinkedServiceReference"
							},
							"name": "sink1",
							"rejectedDataLinkedService": {
								"referenceName": "adls4sapecc",
								"type": "LinkedServiceReference"
							}
						}
					],
					"transformations": [],
					"scriptLines": [
						"source(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     staged: true,",
						"     enableCdc: true,",
						"     readMode: 'fullAndIncrementalLoad',",
						"     keys:['BUKRS','FISCPER','BELNR','BUZEI','UPOSZ'],",
						"     format: 'sapObject') ~> source1",
						"source1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'demo',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable:true,",
						"     insertable:false,",
						"     updateable:false,",
						"     upsertable:true,",
						"     keys:['BELNR'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/SAPECC_FI_AR')]",
				"[concat(variables('factoryId'), '/linkedServices/adls4sapecc')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/s4hordernos')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "S4HSalesOrderNo",
								"type": "DatasetReference"
							},
							"name": "salesordernumber"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "adls4sapecc",
								"type": "LinkedServiceReference"
							},
							"name": "salesordernosADSL",
							"rejectedDataLinkedService": {
								"referenceName": "adls4sapecc",
								"type": "LinkedServiceReference"
							}
						}
					],
					"transformations": [],
					"scriptLines": [
						"source(output(",
						"          AUFNR as string,",
						"          AUART as string,",
						"          KOKRS as string,",
						"          KTEXT as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     staged: true,",
						"     enableCdc: true,",
						"     readMode: 'fullAndIncrementalLoad',",
						"     keys:['AUFNR'],",
						"     format: 'sapObject') ~> salesordernumber",
						"salesordernumber sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'demo',",
						"     folderPath: 'staging',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable:true,",
						"     insertable:false,",
						"     updateable:true,",
						"     upsertable:true,",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> salesordernosADSL"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/S4HSalesOrderNo')]",
				"[concat(variables('factoryId'), '/linkedServices/adls4sapecc')]"
			]
		}
	]
}